<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Guide to Authentication Protocols</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            color: #334155;
        }
        h1, h2, h3, h4, h5, h6, .heading-font {
            font-family: 'Poppins', sans-serif;
        }
        .concept-card {
            transition: all 0.3s ease-in-out;
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(148, 163, 184, 0.35);
            box-shadow: 0 18px 28px rgba(15, 23, 42, 0.08);
            border-radius: 1rem;
        }
        .concept-card:hover {
            box-shadow: 0 22px 34px rgba(15, 23, 42, 0.12);
        }
        .nav-link {
            transition: all 0.2s ease-in-out;
            color: #475569;
        }
        .nav-link.active {
            background-color: rgba(148, 163, 184, 0.32);
            color: #0f172a;
            font-weight: 600;
            transform: translateX(4px);
            box-shadow: none;
        }
        .nav-link:not(.active):hover {
            background-color: rgba(148, 163, 184, 0.2);
            color: #0f172a;
            transform: translateX(2px);
        }
        .sidebar-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(12px);
            border-right: 1px solid rgba(148, 163, 184, 0.35);
        }
        .main-content {
            background: linear-gradient(135deg, rgba(241, 245, 249, 0.96) 0%, rgba(226, 232, 240, 0.88) 100%);
        }
        .main-content > *:first-child {
            margin-top: 0;
        }
        .code-block {
            background-color: #0f172a;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 0.5rem;
            font-family: 'Courier New', Courier, monospace;
            white-space: pre-wrap;
            position: relative;
        }
        .copy-btn {
            position: absolute;
            top: 0.6rem;
            right: 0.6rem;
            background-color: #475569;
            color: #e2e8f0;
            border: none;
            padding: 0.25rem 0.55rem;
            border-radius: 0.25rem;
            cursor: pointer;
            font-size: 0.75rem;
        }
        .copy-btn:hover {
            background-color: #64748b;
        }
        .handshake-step {
            transition: all 0.2s ease-in-out;
        }
        .handshake-step.active {
            border-color: #38bdf8;
            background-color: #f0f9ff;
        }
        .matrix-cell {
            background: rgba(148, 163, 184, 0.14);
        }
    </style>
</head>
<body class="antialiased">
    <div class="flex flex-col md:flex-row min-h-screen">
        <nav class="sidebar-panel w-full md:w-72 bg-white/80 backdrop-blur-md border-r border-slate-200/70 p-6 shrink-0 md:min-h-screen md:sticky md:top-0">
            <h1 class="text-2xl font-bold text-slate-800 mb-2 font-poppins">Auth Protocols</h1>
            <p class="text-sm text-slate-500 mb-8">Understand sign-in flows end-to-end</p>
            <ul class="space-y-2" id="navigation">
                <li><a href="#overview" class="nav-link block p-3 rounded-lg font-medium text-slate-700 active">Protocol Landscape</a></li>
                <li><a href="#kerberos" class="nav-link block p-3 rounded-lg font-medium text-slate-700">Kerberos TGT Flow</a></li>
                <li><a href="#ntlm" class="nav-link block p-3 rounded-lg font-medium text-slate-700">NTLM Challenge/Response</a></li>
                <li><a href="#ldap" class="nav-link block p-3 rounded-lg font-medium text-slate-700">LDAP Bind Options</a></li>
                <li><a href="#federation" class="nav-link block p-3 rounded-lg font-medium text-slate-700">Federation & Tokens</a></li>
                <li><a href="#matrix" class="nav-link block p-3 rounded-lg font-medium text-slate-700">Decision Matrix</a></li>
                <li><a href="#troubleshooting" class="nav-link block p-3 rounded-lg font-medium text-slate-700">Troubleshooting</a></li>
            </ul>
        </nav>

        <main class="main-content w-full md:w-3/4 lg:w-4/5 p-4 md:p-8 lg:p-10 bg-slate-50/70">
            <div id="content-container" class="space-y-8">
                <section id="overview" class="concept-card p-6 md:p-8 rounded-xl shadow-md">
                    <h2 class="text-2xl font-bold text-sky-600 mb-4">üåê Protocol Landscape</h2>
                    <p class="text-lg text-slate-600 mb-4">Active Directory environments rarely rely on a single authentication method. Understanding where each protocol fits prevents mismatched expectations and security gaps.</p>
                    <div class="grid md:grid-cols-3 gap-6 mt-6">
                        <div class="bg-sky-50 border border-sky-200 rounded-xl p-5">
                            <h3 class="font-semibold text-lg text-sky-800 mb-2">Integrated</h3>
                            <p class="text-slate-600">Kerberos is the native Windows protocol. It delivers mutual authentication and delegated access inside trusted forests.</p>
                        </div>
                        <div class="bg-amber-50 border border-amber-200 rounded-xl p-5">
                            <h3 class="font-semibold text-lg text-amber-800 mb-2">Legacy</h3>
                            <p class="text-slate-600">NTLM handles fallbacks, workgroup joins, and down-level systems. It lacks ticketing and is vulnerable to relay attacks.</p>
                        </div>
                        <div class="bg-emerald-50 border border-emerald-200 rounded-xl p-5">
                            <h3 class="font-semibold text-lg text-emerald-800 mb-2">Federated</h3>
                            <p class="text-slate-600">Protocol hand-offs (SAML, OpenID Connect, OAuth) extend sign-in beyond the domain and power modern SaaS SSO.</p>
                        </div>
                    </div>
                    <p class="mt-6 text-slate-700 bg-slate-100 border border-slate-200 rounded-lg p-4">üìå <strong class="font-semibold">Key takeaway:</strong> Map protocols to trust boundaries. Use Kerberos where the domain controls both client and service. Require federation for cloud apps. Limit NTLM to transitional scenarios and monitor it closely.</p>
                </section>

                <section id="kerberos" class="concept-card p-6 md:p-8 rounded-xl shadow-md hidden">
                    <h2 class="text-2xl font-bold text-blue-600 mb-4">üîë Kerberos Ticket-Granting Ticket (TGT) Flow</h2>
                    <p class="text-lg text-slate-600 mb-6">Kerberos uses symmetric keys and short-lived tickets. Follow the handshake below to see how the client, Key Distribution Center (KDC), and services exchange secrets.</p>
                    <div class="grid lg:grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <button class="handshake-step w-full text-left border border-slate-200 rounded-lg p-4" data-target="step1">
                                <span class="font-semibold text-slate-800">1. Initial Authentication (AS-REQ / AS-REP)</span>
                                <p class="text-sm text-slate-600 mt-2">Client proves its identity to the Authentication Service and receives an encrypted TGT.</p>
                            </button>
                            <button class="handshake-step w-full text-left border border-slate-200 rounded-lg p-4" data-target="step2">
                                <span class="font-semibold text-slate-800">2. Service Ticket Request (TGS-REQ / TGS-REP)</span>
                                <p class="text-sm text-slate-600 mt-2">Client presents the TGT to obtain a service ticket scoped to the target SPN.</p>
                            </button>
                            <button class="handshake-step w-full text-left border border-slate-200 rounded-lg p-4" data-target="step3">
                                <span class="font-semibold text-slate-800">3. Mutual Authentication (AP-REQ / AP-REP)</span>
                                <p class="text-sm text-slate-600 mt-2">Client attaches the service ticket to access the resource. If the service supports it, it responds with AP-REP to confirm its identity.</p>
                            </button>
                        </div>
                        <div class="bg-blue-50 border border-blue-200 rounded-xl p-6" id="handshake-details">
                            <h3 class="font-semibold text-xl text-blue-900 mb-3">Handshake Detail</h3>
                            <p class="text-slate-700 leading-relaxed" id="handshake-description">Select a step on the left to see what is exchanged, the encryption keys involved, and typical failure codes.</p>
                            <ul class="mt-4 space-y-3 text-sm text-slate-600" id="handshake-messages"></ul>
                        </div>
                    </div>
                    <div class="mt-8">
                        <h3 class="font-semibold text-lg text-slate-800 mb-3">Quick Checks</h3>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div class="bg-slate-100 p-4 rounded-lg border border-slate-200">
                                <h4 class="font-semibold text-slate-700 mb-1">Validate SPNs</h4>
                                <p class="text-sm text-slate-600">Duplicate or missing SPNs break TGS-REQ. Run <code class="bg-slate-200 px-1 rounded">setspn -X</code> to catch duplicates.</p>
                            </div>
                            <div class="bg-slate-100 p-4 rounded-lg border border-slate-200">
                                <h4 class="font-semibold text-slate-700 mb-1">Ticket Lifetime</h4>
                                <p class="text-sm text-slate-600">Check <code class="bg-slate-200 px-1 rounded">klist</code> for TGT expiry. Desynced time causes <code class="bg-slate-200 px-1 rounded">KRB_AP_ERR_SKEW</code>.</p>
                            </div>
                        </div>
                    </div>
                    <div class="mt-8">
                        <h3 class="font-semibold text-lg text-slate-800 mb-3">PowerShell Quick Audit</h3>
                        <div class="code-block"><button class="copy-btn">Copy</button><span>Get-ADUser -Filter * -Properties ServicePrincipalName |
    Where-Object { $_.ServicePrincipalName -match "/" } |
    Select-Object Name, ServicePrincipalName |
    Export-Csv .\spn-audit.csv -NoTypeInformation</span></div>
                    </div>
                </section>

                <section id="ntlm" class="concept-card p-6 md:p-8 rounded-xl shadow-md hidden">
                    <h2 class="text-2xl font-bold text-amber-600 mb-4">üõë NTLM Challenge/Response</h2>
                    <p class="text-lg text-slate-600 mb-6">NTLM is challenge/response based. It lacks mutual authentication and is vulnerable to relay and credential forwarding.</p>
                    <div class="bg-amber-50 border border-amber-200 rounded-xl p-6">
                        <h3 class="font-semibold text-lg text-amber-900 mb-3">Flow Snapshot</h3>
                        <ol class="list-decimal list-inside space-y-3 text-slate-700">
                            <li>Client sends a NEGOTIATE message listing supported features.</li>
                            <li>Server responds with a challenge containing an 8-byte nonce.</li>
                            <li>Client encrypts the nonce with the user's NT hash and returns the response. Server validates via the domain controller.</li>
                        </ol>
                    </div>
                    <div class="mt-6 grid md:grid-cols-2 gap-6">
                        <div class="bg-white border border-amber-200 rounded-xl p-5">
                            <h3 class="font-semibold text-slate-800 mb-2">Detect Usage</h3>
                            <p class="text-sm text-slate-600">Enable NTLM auditing and monitor security events <code class="bg-slate-200 px-1 rounded">4624</code> (logon) and <code class="bg-slate-200 px-1 rounded">4776</code> (credentials validated).</p>
                        </div>
                        <div class="bg-white border border-amber-200 rounded-xl p-5">
                            <h3 class="font-semibold text-slate-800 mb-2">Mitigate Risk</h3>
                            <p class="text-sm text-slate-600">Prefer Kerberos, enable SMB signing, and use Protected Users or Extended Protection for Authentication to block relays.</p>
                        </div>
                    </div>
                    <div class="mt-8">
                        <h3 class="font-semibold text-lg text-slate-800 mb-3">GPO Baseline</h3>
                        <div class="code-block"><button class="copy-btn">Copy</button><span># Set NTLM to audit mode first
Set-ItemProperty -Path "HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa" -Name "RestrictSendingNTLMTraffic" -Value 2

# Harden LM/NTLM responses
Set-ItemProperty -Path "HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa" -Name "LmCompatibilityLevel" -Value 5
</span></div>
                    </div>
                </section>

                <section id="ldap" class="concept-card p-6 md:p-8 rounded-xl shadow-md hidden">
                    <h2 class="text-2xl font-bold text-purple-600 mb-4">üìÅ LDAP Bind Options</h2>
                    <p class="text-lg text-slate-600 mb-6">LDAP binds control how service accounts authenticate to directory services. Choose the right bind type for the sensitivity of data and the network path.</p>
                    <div class="grid md:grid-cols-3 gap-6">
                        <div class="bg-purple-50 border border-purple-200 rounded-xl p-5">
                            <h3 class="font-semibold text-purple-800 mb-1">Simple Bind</h3>
                            <p class="text-sm text-slate-600">Username and password are sent in clear text. Only safe over LDAPS (636) or StartTLS.</p>
                        </div>
                        <div class="bg-purple-50 border border-purple-200 rounded-xl p-5">
                            <h3 class="font-semibold text-purple-800 mb-1">SASL / GSSAPI</h3>
                            <p class="text-sm text-slate-600">Uses Kerberos for authentication. Supports channel binding and mutual auth.</p>
                        </div>
                        <div class="bg-purple-50 border border-purple-200 rounded-xl p-5">
                            <h3 class="font-semibold text-purple-800 mb-1">Anonymous</h3>
                            <p class="text-sm text-slate-600">Very limited access. Disable unless required for public directories.</p>
                        </div>
                    </div>
                    <div class="mt-6 bg-slate-100 border border-slate-200 rounded-xl p-6">
                        <h3 class="font-semibold text-slate-800 mb-3">TLS Checklist</h3>
                        <ul class="list-disc list-inside space-y-2 text-slate-700">
                            <li>Install a certificate with appropriate EKU (Server Authentication) on each DC.</li>
                            <li>Enable LDAP signing via Group Policy (<code class="bg-slate-200 px-1 rounded">Domain Controller: LDAP server signing requirements</code>).</li>
                            <li>Test StartTLS with <code class="bg-slate-200 px-1 rounded">ldp.exe</code> or <code class="bg-slate-200 px-1 rounded">Test-LdapStartTls</code>.</li>
                        </ul>
                    </div>
                </section>

                <section id="federation" class="concept-card p-6 md:p-8 rounded-xl shadow-md hidden">
                    <h2 class="text-2xl font-bold text-emerald-600 mb-4">ü™™ Federation & Token-Based Access</h2>
                    <p class="text-lg text-slate-600 mb-6">When identities move beyond the domain boundary, claims-based protocols take over. Tokens carry signed assertions instead of shared secrets.</p>
                    <div class="grid lg:grid-cols-3 gap-6">
                        <div class="bg-emerald-50 border border-emerald-200 rounded-xl p-5">
                            <h3 class="font-semibold text-emerald-800 mb-2">SAML 2.0</h3>
                            <p class="text-sm text-slate-600">XML assertions delivered via browser redirects. Common for SaaS SSO integrations.</p>
                        </div>
                        <div class="bg-emerald-50 border border-emerald-200 rounded-xl p-5">
                            <h3 class="font-semibold text-emerald-800 mb-2">OpenID Connect</h3>
                            <p class="text-sm text-slate-600">OAuth 2.0 + ID tokens. JSON payloads, ideal for modern web and mobile apps.</p>
                        </div>
                        <div class="bg-emerald-50 border border-emerald-200 rounded-xl p-5">
                            <h3 class="font-semibold text-emerald-800 mb-2">OAuth 2.0</h3>
                            <p class="text-sm text-slate-600">Delegated authorization. Issues access tokens for APIs. Often paired with OIDC.</p>
                        </div>
                    </div>
                    <div class="mt-6 bg-white border border-emerald-200 rounded-xl p-6">
                        <h3 class="font-semibold text-slate-800 mb-3">Token Anatomy</h3>
                        <div class="code-block"><button class="copy-btn">Copy</button><span>{
  "aud": "https://graph.microsoft.com/",
  "iss": "https://sts.contoso.com/",
  "exp": 1712192047,
  "iat": 1712188447,
  "sub": "a1b2c3d4",
  "roles": ["User.Read", "Mail.Read"],
  "upn": "alex@contoso.com"
}</span></div>
                        <p class="text-sm text-slate-600 mt-4">Validate the signature (alg + kid), issuer, audience, and lifetime before exchanging tokens for backend calls.</p>
                    </div>
                </section>

                <section id="matrix" class="concept-card p-6 md:p-8 rounded-xl shadow-md hidden">
                    <h2 class="text-2xl font-bold text-indigo-600 mb-4">üß≠ Decision Matrix</h2>
                    <p class="text-lg text-slate-600 mb-6">Use the quick matrix below to choose the correct protocol for a workload.</p>
                    <div class="overflow-x-auto">
                        <table class="min-w-full border-collapse text-sm text-slate-700">
                            <thead class="bg-slate-200 text-slate-800">
                                <tr>
                                    <th class="px-4 py-3 text-left">Scenario</th>
                                    <th class="px-4 py-3 text-left">Recommended Protocol</th>
                                    <th class="px-4 py-3 text-left">Key Notes</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="border-b border-slate-200 matrix-cell">
                                    <td class="px-4 py-3">Domain-joined client to file share</td>
                                    <td class="px-4 py-3 font-semibold text-slate-800">Kerberos</td>
                                    <td class="px-4 py-3">Supports mutual auth, constrained delegation, and automatic ticket renewals.</td>
                                </tr>
                                <tr class="border-b border-slate-200">
                                    <td class="px-4 py-3">Legacy device without domain trust</td>
                                    <td class="px-4 py-3 font-semibold text-slate-800">NTLM (temporary)</td>
                                    <td class="px-4 py-3">Plan remediation. Limit to specific hosts using firewall rules.</td>
                                </tr>
                                <tr class="border-b border-slate-200 matrix-cell">
                                    <td class="px-4 py-3">3rd-party SaaS integration</td>
                                    <td class="px-4 py-3 font-semibold text-slate-800">SAML or OpenID Connect</td>
                                    <td class="px-4 py-3">Use Azure AD/ADFS as IdP. Map claims to app roles.</td>
                                </tr>
                                <tr class="border-b border-slate-200">
                                    <td class="px-4 py-3">Custom line-of-business API</td>
                                    <td class="px-4 py-3 font-semibold text-slate-800">OAuth 2.0 + OIDC</td>
                                    <td class="px-4 py-3">Issue access tokens and use refresh tokens for long-lived sessions.</td>
                                </tr>
                                <tr class="matrix-cell">
                                    <td class="px-4 py-3">Directory service query by an app</td>
                                    <td class="px-4 py-3 font-semibold text-slate-800">LDAP w/ SASL</td>
                                    <td class="px-4 py-3">Require TLS, channel binding, and least-privilege service accounts.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <section id="troubleshooting" class="concept-card p-6 md:p-8 rounded-xl shadow-md hidden">
                    <h2 class="text-2xl font-bold text-rose-600 mb-4">üß™ Troubleshooting Playbook</h2>
                    <p class="text-lg text-slate-600 mb-6">Authentication failures are often timing, SPN, or policy related. Use the playbook to triage quickly.</p>
                    <div class="grid lg:grid-cols-3 gap-6">
                        <div class="bg-white border border-rose-200 rounded-xl p-5">
                            <h3 class="font-semibold text-rose-800 mb-2">Kerberos</h3>
                            <ul class="list-disc list-inside text-sm text-slate-600 space-y-1">
                                <li>Error <code class="bg-slate-200 px-1 rounded">KRB_AP_ERR_MODIFIED</code>: Check SPNs, duplicate machine accounts.</li>
                                <li><code class="bg-slate-200 px-1 rounded">KRB_ERR_CLIENT_REVOKED</code>: Account disabled or password expired.</li>
                                <li>Use <code class="bg-slate-200 px-1 rounded">klist purge</code> to clear cached tickets.</li>
                            </ul>
                        </div>
                        <div class="bg-white border border-rose-200 rounded-xl p-5">
                            <h3 class="font-semibold text-rose-800 mb-2">NTLM</h3>
                            <ul class="list-disc list-inside text-sm text-slate-600 space-y-1">
                                <li>Audit failures with Event IDs <code class="bg-slate-200 px-1 rounded">4625</code> (logon) and <code class="bg-slate-200 px-1 rounded">4771</code> (Kerberos pre-auth).</li>
                                <li>Verify channel binding on IIS/SMB to block relays.</li>
                                <li>Network traces expose <code class="bg-slate-200 px-1 rounded">NTLMSSP_NEGOTIATE</code> packages.</li>
                            </ul>
                        </div>
                        <div class="bg-white border border-rose-200 rounded-xl p-5">
                            <h3 class="font-semibold text-rose-800 mb-2">Federation</h3>
                            <ul class="list-disc list-inside text-sm text-slate-600 space-y-1">
                                <li>Check token signing certificates and clock skew between IdP and SP.</li>
                                <li>Validate audience/issuer using <code class="bg-slate-200 px-1 rounded">jwt.ms</code> or <code class="bg-slate-200 px-1 rounded">jwt.io</code>.</li>
                                <li>Review claim rules for missing attributes.</li>
                            </ul>
                        </div>
                    </div>
                    <div class="mt-8 bg-slate-100 border border-slate-200 rounded-xl p-6">
                        <h3 class="font-semibold text-slate-800 mb-3">Packet Capture Cheatsheet</h3>
                        <div class="grid md:grid-cols-2 gap-4 text-sm text-slate-600">
                            <div class="bg-white border border-slate-200 rounded-lg p-4">
                                <p class="font-semibold text-slate-700">Kerberos Filter</p>
                                <p class="mt-1"><code class="bg-slate-200 px-1 rounded">udp.port == 88 || tcp.port == 88</code></p>
                            </div>
                            <div class="bg-white border border-slate-200 rounded-lg p-4">
                                <p class="font-semibold text-slate-700">NTLM Filter</p>
                                <p class="mt-1"><code class="bg-slate-200 px-1 rounded">ntlmssp</code></p>
                            </div>
                            <div class="bg-white border border-slate-200 rounded-lg p-4">
                                <p class="font-semibold text-slate-700">LDAP StartTLS</p>
                                <p class="mt-1"><code class="bg-slate-200 px-1 rounded">ldap && tcp.port == 389</code></p>
                            </div>
                            <div class="bg-white border border-slate-200 rounded-lg p-4">
                                <p class="font-semibold text-slate-700">SAML POST</p>
                                <p class="mt-1"><code class="bg-slate-200 px-1 rounded">http.request.method == "POST" && frame contains "SAMLResponse"</code></p>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <script>
        const handshakeData = {
            step1: {
                description: "Client encrypts a timestamp with the user's long-term key and requests a TGT from the KDC's Authentication Service (AS). The AS-REP returns the TGT encrypted with the krbtgt key and a session key for the client.",
                messages: [
                    "AS-REQ: { cname, realm, timestamp }",
                    "AS-REP: { TGT(client, krbtgt), session key }",
                    "Failure codes: KRB_ERR_CLIENT_REVOKED, KRB_ERR_CLOCK_SKEW"
                ]
            },
            step2: {
                description: "Using the TGT, the client contacts the Ticket Granting Service for a specific SPN. The KDC issues a service ticket encrypted with the service account key and returns a client copy encrypted with the session key.",
                messages: [
                    "TGS-REQ: { TGT, authenticator, target SPN }",
                    "TGS-REP: { Service ticket, session key }",
                    "Failure codes: KRB_AP_ERR_MODIFIED, KDC_ERR_S_PRINCIPAL_UNKNOWN"
                ]
            },
            step3: {
                description: "The client presents the AP-REQ (service ticket + authenticator) to the resource. If the service proves its identity back, you gain mutual authentication.",
                messages: [
                    "AP-REQ: { service ticket, authenticator }",
                    "AP-REP: optional mutual auth response",
                    "Failure codes: KRB_AP_ERR_TKT_EXPIRED, KRB_AP_ERR_BAD_INTEGRITY"
                ]
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            const isMobile = window.innerWidth < 768;
            const navLinks = document.querySelectorAll('.nav-link');
            const contentCards = document.querySelectorAll('.concept-card');
            const navigation = document.getElementById('navigation');
            const sidebar = document.querySelector('nav');
            const mainContent = document.querySelector('main');

            if (isMobile) {
                sidebar.classList.add('hidden');
                mainContent.classList.remove('md:w-3/4', 'lg:w-4/5', 'md:p-8', 'lg:p-10');
                mainContent.classList.add('w-full', 'p-4');

                contentCards.forEach(card => {
                    card.classList.remove('hidden');
                    const header = card.querySelector('h2');
                    const content = Array.from(card.children).filter(child => child.tagName !== 'H2');
                    content.forEach(el => el.classList.add('hidden'));

                    header.classList.add('cursor-pointer');
                    header.addEventListener('click', () => {
                        const isHidden = content[0].classList.contains('hidden');
                        content.forEach(el => el.classList.toggle('hidden', !isHidden));
                    });
                });
            } else {
                function showContent(hash) {
                    const targetId = hash.substring(1);
                    contentCards.forEach(card => card.classList.add('hidden'));
                    const targetCard = document.getElementById(targetId);
                    if (targetCard) targetCard.classList.remove('hidden');
                    navLinks.forEach(link => {
                        link.classList.toggle('active', link.getAttribute('href') === hash);
                    });
                }
                navigation.addEventListener('click', (e) => {
                    if (e.target.tagName === 'A') {
                        e.preventDefault();
                        const hash = e.target.getAttribute('href');
                        if (window.location.hash !== hash) {
                            window.location.hash = hash;
                            showContent(hash);
                        }
                    }
                });
                const initialHash = window.location.hash || '#overview';
                showContent(initialHash);
            }

            document.querySelectorAll('.copy-btn').forEach(button => {
                button.addEventListener('click', () => {
                    const code = button.nextElementSibling.innerText;
                    const textArea = document.createElement('textarea');
                    textArea.value = code;
                    document.body.appendChild(textArea);
                    textArea.select();
                    try {
                        document.execCommand('copy');
                        button.textContent = 'Copied!';
                    } catch (err) {
                        button.textContent = 'Failed!';
                    }
                    document.body.removeChild(textArea);
                    setTimeout(() => button.textContent = 'Copy', 2000);
                });
            });

            const handshakeButtons = document.querySelectorAll('.handshake-step');
            const handshakeDescription = document.getElementById('handshake-description');
            const handshakeMessages = document.getElementById('handshake-messages');

            handshakeButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const target = button.getAttribute('data-target');
                    handshakeButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    const data = handshakeData[target];
                    handshakeDescription.textContent = data.description;
                    handshakeMessages.innerHTML = data.messages.map(item => `<li>${item}</li>`).join('');
                });
            });

            const defaultActive = document.querySelector('.handshake-step');
            if (defaultActive) {
                defaultActive.click();
            }
        });
    </script>
</body>
</html>
